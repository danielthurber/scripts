---
title: "Catchments"
author: "Daniel Thurber"
date: "9/24/2021"
output: pdf_document
---
Initialize script with folder locations, libraries, and variables DF
```{r}
library(zoo, warn.conflicts = F)
library(raster, warn.conflicts = F)
vars.df <- read.csv('C:/Users/Daniel/Documents/Research/O2_variables.csv')
rast.dir <- 'C:/Users/Daniel/Documents/Research/gis_projects/O2_catchments/O2_rasters'
catch.list <- as.character(vars.df$SITE_NO_tx)
```

Add leading zeroes to 7-digit codes.
```{r}
for (i in 1:67) {
  if (nchar(catch.list[i])<8){
    catch.list[i] <- paste0("0",catch.list[i])
  }
}
```

Enter the feature ID of the catchment to analyze
```{r}
FID <- 0
x <- FID +1 #DF row for that catchment
gage.code <- catch.list[x]
paste(gage.code, vars.df$STANAME[x])
Eraster <- paste0('E_',gage.code, '.tif')
Araster <- paste0('A_',gage.code, '.tif')
Hraster <- paste0('H_',gage.code, '.tif')
```


```{r}
DEM <- raster(paste0(rast.dir,'/',Eraster))
aspect <- raster(paste0(rast.dir,'/',Araster))
HillShade <- raster(paste0(rast.dir,'/',Hraster))
elevFreq <- freq(DEM)
```

```{r}
dem.df <- as.data.frame(DEM)
a.df <- as.data.frame(aspect)
a.df$sin <- sin(a.df$A_08269000*pi/180)
a.df$cos <- cos(a.df$A_08269000*pi/180)

hs.df <- as.data.frame(HillShade)
```



```{r}
min(dem.df, na.rm = T)
```

```{r}
catchment <- 'LR @ Tony Grove'  #full river name to display in plots
#GCS: 7705, KN: 7250, TF: 7406, USUDD: 8270, TGRS: 6332, TGL: 8474, FB: 8140
st1 <- 'Klondike Narrows'
st1el <- 7250*.3048  #elevations in feet: multiply by 0.3048 ft/m
#st2 <- ''
#st2el <- 7987*.3048
```

View the elevFreq dataframe.  If there are rows for zero or negative values, remove them.
```{r}
head(elevFreq,3)
tail(elevFreq,3)
st1el
```


Create a dataframe with frequencies of all elevation values and cumulative sums
```{r}
truelev <- data.frame(elevFreq[c(1:(nrow(elevFreq)-1)),]) #ignores last row with NA values
#truelev <- data.frame(elevFreq[-c(1,2),]) #use this to remove any rows
for (i in seq(1,nrow(truelev))){
  truelev$sum[i] <- sum(truelev$count[1:i])
}

truelev$CDVal <- truelev$sum/sum(truelev$count)
tail(truelev,2) #last two lines should approach and equal 1 for CDVal
```

Determine and look at the total range of elevations
```{r}
minelev <- min(truelev$value)
maxelev <- max(truelev$value)
elevrange <- maxelev - minelev
minelev
maxelev
elevrange
```
Generate a column of elevation proportion and determine hypsometric integral and median elevation
```{r}
truelev$elevprop <- (truelev$value-minelev)/elevrange
head(truelev,3)
tail(truelev,3)
HI <- sum(truelev$count*truelev$elevprop)/sum(truelev$count) #determines hypsometric integral
medElev <- truelev$value[which(truelev$CDVal>0.5)[1]] #displays the median
paste('Hypsometric Integral:', HI, '; median elevation (m):', medElev)

```


```{r}
truelev$local11 <- c(NA,NA,NA,NA,NA,rollmean(truelev$count,11),NA,NA,NA,NA,NA)
```



```{r}
plot(truelev$CDVal~truelev$value, 
     xlab = 'Elevation', 
     ylab = "Cumulative Percent", 
     main = paste0('Cumulative Elevation Distribution for ', catchment), 
     type = 'l')
abline(v = st1el, col = 'darkolivegreen4')
#abline(v = st2el, col = 'lightsalmon2')
legend('bottomright', inset = .05, lty = 1, legend = c(st1), col = c('darkolivegreen4'), title = 'SnoTel Sites')
```

```{r}
plot((truelev$count/sum(truelev$count))~truelev$value,
     xlab = 'Elevation',
     ylab = "Cumulative Percent",
     main = paste0('Relative Elevation Distribution for ', catchment),
     type = "l")

```



```{r}
plot((truelev$local11/sum(truelev$count))~truelev$value,
     xlab = 'Elevation',
     ylab = "Relative Percent",
     main = paste0('Relative Elevation Distribution for ', catchment),
     type = "l")
abline(v = st1el, col = 'darkolivegreen4')
abline(v = st2el, col = 'lightsalmon2')
legend('topleft', inset = .05, lty = 1, legend = c(st1, st2), col = c('darkolivegreen4','lightsalmon2'), title = 'SnoTel Sites')
```


